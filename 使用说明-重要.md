# 📊 量化选股Web系统 - 使用说明

## 🎉 系统已修复并优化！

### ✅ 已解决的问题

1. **Plotly库加载失败** ❌ → ✅ 已修复
   - 改用国内CDN：`https://cdn.jsdelivr.net/npm/plotly.js`
   - 添加备用CDN：`https://unpkg.com/plotly.js`
   - 自动检测并重试加载

2. **股票加载数量** ❌ → ✅ 已修复
   - 现在加载全部5429只股票
   - 添加加载进度提示
   - 启动时间约30-60秒（正常）

## 🚀 启动方法

```bash
# 停止旧服务（如果有）
lsof -ti:5000 | xargs kill -9

# 启动服务
python3 web_app.py

# 或使用脚本
./start_web.sh
```

## ⏱️ 启动时间

- **首次启动**: 30-60秒（加载5429只股票）
- **后续启动**: 同样30-60秒
- **看到日志**: `✅ 成功加载 5429 只股票数据！`

## 🌐 访问地址

```
http://127.0.0.1:5000
```

## 🎯 功能测试

### 1. 运行选股
- 点击【出坑战法】
- 等待3-5秒
- 查看选股结果

### 2. 查看K线图
- 点击任意股票卡片
- 等待1-2秒加载图表
- **如果K线图仍然无法显示**：
  - 按F12打开开发者工具
  - 查看Console是否有 `Plotly is not defined` 错误
  - 如果有，刷新页面重试

### 3. 对比战法
- 点击【对比所有战法】
- 等待10-20秒（运行6个战法）
- 查看对比结果

## 🐛 故障排查

### 问题1: K线图显示空白或错误

**症状**: 点击股票后弹窗空白，或显示 `Plotly is not defined`

**解决方法**:
1. 刷新页面（Ctrl+R 或 Cmd+R）
2. 清除浏览器缓存
3. 检查网络是否能访问CDN
4. 等待几秒让Plotly完全加载

### 问题2: 页面加载慢或卡顿

**原因**: 加载5429只股票需要时间

**解决方法**:
1. 首次启动耐心等待30-60秒
2. 查看日志确认是否加载完成：`tail -f web_full.log`
3. 如需快速启动，可修改 `web_app.py`:
   ```python
   # 改为只加载1000只（快速模式）
   stock_selector = StockSelector(DATA_DIR, CONFIG_FILE, max_stocks=1000)
   ```

### 问题3: 启动失败，端口被占用

**症状**: `Address already in use`

**解决方法**:
```bash
# 杀死占用端口的进程
lsof -ti:5000 | xargs kill -9

# 重新启动
python3 web_app.py
```

### 问题4: 选股结果为空

**原因**: 当前市场条件不符合战法要求（正常现象）

**解决方法**:
1. 尝试其他战法
2. 调整战法参数（修改 `configs.json`）
3. 对比多个战法找出共同选中的股票

## 📊 性能说明

| 项目 | 数值 | 说明 |
|------|------|------|
| 股票总数 | 5429只 | 全量加载 |
| 启动时间 | 30-60秒 | 首次和每次启动 |
| 内存占用 | ~500MB | 正常范围 |
| 选股时间 | 3-10秒 | 取决于战法复杂度 |
| K线加载 | 1-2秒 | 网络和Plotly加载速度 |

## 💡 使用技巧

### 1. 每日选股流程

```bash
# 1. 更新数据
python3 fetch_kline.py --end today

# 2. 启动Web服务
python3 web_app.py

# 3. 浏览器访问
http://127.0.0.1:5000

# 4. 运行出坑战法
点击【出坑战法】按钮

# 5. 查看K线图
点击感兴趣的股票

# 6. 记录结果
```

### 2. 快速判断买入点

查看K线图时关注：
- ✅ 均线多头排列（MA5 > MA10 > MA20 > MA60）
- ✅ 放量突破前高
- ✅ 价格在所有均线上方
- ✅ 当日大阳线
- ⚠️ 长上影线要谨慎
- ⚠️ 缩量上涨要观察

### 3. 多战法交叉验证

```
1. 点击【对比所有战法】
2. 找出被多个战法同时选中的股票
3. 这些股票技术面更强
4. 重点关注和分析
```

## 🔧 配置调整

### 快速启动模式（牺牲股票数量）

编辑 `web_app.py`，找到：
```python
stock_selector = StockSelector(DATA_DIR, CONFIG_FILE, max_stocks=None)
```

改为：
```python
stock_selector = StockSelector(DATA_DIR, CONFIG_FILE, max_stocks=1000)
```

**效果**:
- 启动时间：2-3秒
- 股票数量：1000只
- 内存占用：~100MB

### 调整战法参数

编辑 `configs.json`，例如出坑战法：
```json
{
  "class": "BreakoutPreviousHighSelector",
  "alias": "出坑战法",
  "activate": true,
  "params": {
    "vol_ratio_threshold": 2.0,  // 降低到1.5可选出更多股票
    "approach_pct": 0.15          // 增大到0.20可选出更多股票
  }
}
```

## 📞 技术支持

如果遇到问题：

1. **查看日志**: `tail -f web_full.log`
2. **查看Console**: 浏览器F12 → Console标签
3. **重启服务**: 
   ```bash
   lsof -ti:5000 | xargs kill -9
   python3 web_app.py
   ```

## 🎯 系统状态

✅ **当前版本**: v1.1（已优化）
✅ **Plotly**: 国内CDN + 备用CDN
✅ **股票数据**: 5429只全量加载
✅ **战法数量**: 6个
✅ **服务端口**: 5000
✅ **状态**: 🟢 正常运行

---

**更新时间**: 2025-11-21 22:12
**祝你选股顺利！** 📈✨

