# 📈 交易信号系统 - B1/B2/S1 自动标记

## 🎯 系统概述

基于知行交易体系，自动识别并标记关键买卖点：
- **B1买点** 🟢 - 超卖后首次转强（核心买点）
- **B2加仓** 🟢 - B1后次日继续上涨（加仓点）
- **S1卖点** 🔴 - 放量大阴线（止盈/止损点）

---

## 📊 B1买点识别算法

### 定义
在强趋势回撤中，当KDJ的J值到达"大负值"（显著超卖）后，首次走出右侧转强迹象的位置。

### 识别条件（四重验证）

```python
✅ 条件1：J值曾到达大负值区域
   - 近10日最低J值 < -20

✅ 条件2：J值开始回升
   - 当前J值 > 前一日J值

✅ 条件3：价格右侧转强
   - 收出阳线（收盘价 > 开盘价）
   - 价格上涨（收盘价 > 前一日收盘价）

✅ 条件4：成交量放大确认
   - 当日成交量 > 5日均量 × 1.2
```

### K线图标记
- **符号**: 绿色向上三角 ▲
- **位置**: 价格下方3%
- **文字**: "B1"（绿色加粗）
- **说明**: 这是核心买入点

### 操作策略
1. **发现B1信号** → 确认符合四大条件
2. **入场时机** → B1当天收盘前或次日开盘
3. **止损设置** → B1当日K线最低价下方2-5个价位
4. **纪律铁律** → "只输一根K线"，跌破立即离场

---

## 📊 B2加仓点识别算法

### 定义
B1买入后，次日继续上涨，确认趋势转强，可适当加仓。

### 识别条件

```python
✅ 前提：前一日出现B1信号

✅ 条件1：继续收阳线
   - 收盘价 > 开盘价

✅ 条件2：价格创新高
   - 收盘价 > B1日收盘价
```

### K线图标记
- **符号**: 深绿色向上三角 ▲
- **位置**: 价格下方3%
- **文字**: "B2"（深绿色加粗）
- **说明**: 适合加仓，但注意仓位控制

### 操作策略
1. **B1已持仓** → 看到B2可适当加仓
2. **加仓比例** → 建议不超过首次仓位50%
3. **止损调整** → 保持在B1的K线最低价下方
4. **风险控制** → 总仓位不超过30%

---

## 📊 S1卖点识别算法

### 定义
放量大阴线，表示获利盘涌出或主力出货，至少应该减仓一半。

### 识别条件

```python
✅ 条件1：收出阴线
   - 收盘价 < 开盘价

✅ 条件2：实体较大
   - 阴线实体占整根K线60%以上

✅ 条件3：成交量明显放大
   - 当日成交量 > 5日均量 × 1.5

✅ 条件4：跌幅显著
   - 跌幅 > 3%
```

### K线图标记
- **符号**: 红色向下三角 ▼
- **位置**: 价格上方3%
- **文字**: "S1"（红色加粗）
- **说明**: 警惕信号，至少减仓50%

### 操作策略
1. **看到S1** → 立即减仓50%或全部离场
2. **持有B1/B2** → 如果出现S1，果断止盈
3. **观察形态** → 次日如继续阴跌，清仓离场
4. **资金管理** → 保住利润最重要

---

## 📈 趋势线系统

### 短期趋势线（10日均线）
- **颜色**: 红色粗线（2.5px）
- **周期**: 10个交易日
- **作用**: 判断短期趋势方向
- **用法**: 
  - 价格在线上 = 短期多头
  - 价格在线下 = 短期空头
  - 线斜率上升 = 趋势向上

### 长期趋势线（30日均线）
- **颜色**: 蓝色粗线（2.5px）
- **周期**: 30个交易日
- **作用**: 判断长期趋势方向
- **用法**:
  - 价格在线上 = 长期多头
  - 价格在线下 = 长期空头
  - 短期线上穿长期线 = 金叉

### 趋势判断法则

```
🟢 最强形态：价格 > 短期线 > 长期线（多头排列）
   → B1信号可重仓，B2积极加仓

🟡 中性形态：价格在两线之间震荡
   → B1轻仓试探，B2谨慎

🔴 弱势形态：价格 < 长期线 < 短期线（空头排列）
   → 不做B1，看到S1立即离场
```

---

## 💡 综合实战案例

### 案例1：完美B1买点（603027）

**背景**: 股价从高点回调，进入超卖区

**信号出现**:
1. **Day 1-5**: J值持续下跌，最低到-25（超卖）
2. **Day 6**: 
   - ✅ J值开始回升（-25 → -15）
   - ✅ 收出中阳线，价格企稳
   - ✅ 成交量放大至5日均量1.5倍
   - ✅ 价格站上短期趋势线
   - **🟢 系统标记B1买点**

**操作流程**:
```
1. 看到B1标记 → 确认信号有效
2. Day 6收盘前 → 建仓30%（如6.50元）
3. 设置止损 → 6.20元（B1当日最低价-5分）
4. 观察Day 7 → 如继续上涨，看是否出现B2
```

**Day 7结果**:
- ✅ 继续收阳线，收盘6.80元
- ✅ 价格突破前高
- ✅ **🟢 系统标记B2加仓点**
- **行动**: 加仓15%（总仓位45%）

**Day 8-12**: 
- 持续上涨至7.50元
- **收益**: (7.50 - 6.50) / 6.50 = 15.4%

**Day 13**:
- ❌ 出现放量大阴线，跌至7.20
- ❌ **🔴 系统标记S1卖点**
- **行动**: 立即减仓50%，锁定7%利润

---

### 案例2：假B1信号（风险案例）

**背景**: 弱势下跌中出现反弹

**信号出现**:
- **Day 1**: 系统标记B1（J值-30→-20，收小阳线）
- **但注意**: 
  - ⚠️ 长期趋势线向下
  - ⚠️ 价格仍在两条趋势线下方
  - ⚠️ 成交量萎缩

**操作**:
```
1. 看到B1，但趋势弱 → 轻仓或不做
2. 如果买入 → 严格止损
3. Day 2直接跌破B1最低价 → 立即止损离场
4. 只输一根K线 → 损失-3%
```

**教训**: 
- B1信号必须配合趋势线使用
- 弱势中的B1成功率低
- 严格止损是保命法则

---

## 🎯 信号组合策略

### 最佳买入组合 ⭐⭐⭐⭐⭐

```
B1 + 趋势向上 + MACD金叉 + KDJ低位
→ 重仓买入（30-50%）
```

### 稳健买入组合 ⭐⭐⭐⭐

```
B1 + 趋势横盘 + 成交量放大
→ 轻仓买入（10-20%）
```

### 加仓组合 ⭐⭐⭐⭐⭐

```
B1持仓 + 出现B2 + 趋势线向上
→ 加仓（首仓50%）
```

### 止盈组合 ⭐⭐⭐⭐⭐

```
持仓盈利 + 出现S1 + MACD死叉
→ 立即止盈50%以上
```

### 止损组合 ⭐⭐⭐⭐⭐

```
B1买入 + 跌破B1最低价
→ 无条件止损（不管是否S1）
```

---

## 📊 信号统计功能

在K线图标题会显示信号统计：

```
603027 K线图 【B1:3 | B2:2 | S1:1】
```

**解读**:
- **B1:3** - 近期出现3次买点机会
- **B2:2** - 其中2次B1后出现加仓机会
- **S1:1** - 出现1次卖点信号

**统计用法**:
- B1多但B2少 → 假信号多，趋势不稳
- B1少且B2多 → 信号质量高，趋势强劲
- S1频繁出现 → 震荡市或下跌市，谨慎

---

## ⚠️ 重要风险提示

### 纪律铁律："只输一根K线"

```
这是知行体系的核心风控！

1. 入场时立即设定止损位
   止损位 = B1当日最低价 - (2-5个价位)

2. 一旦跌破止损位，无条件离场
   不要幻想反弹
   不要加仓摊平
   不要死扛到底

3. 保住本金比什么都重要
   只输一根K线 = 最多亏损3-5%
   不止损 = 可能亏损20-50%
```

### 信号失效的情况

```
❌ 1. 弱势环境中的B1
   → 长期趋势线向下，不做B1

❌ 2. 缩量的B1或B2
   → 成交量萎缩，假信号概率大

❌ 3. 跳空高开后的B2
   → 追高风险大，容易被套

❌ 4. 连续涨停后的S1
   → 可能是洗盘，不一定要卖

❌ 5. 不设止损的任何交易
   → 违反纪律，必定失败
```

---

## 🔧 系统参数调整

如果需要调整信号识别的敏感度，可修改 `web_app.py`:

### 调整B1敏感度

```python
# 在 _identify_trading_signals 函数中

# B1条件：J值超卖阈值
j_min_last10 < -20  # 改为-30更严格，-10更宽松

# B1条件：成交量放大倍数
vol_current > vol_ma5 * 1.2  # 改为1.5更严格，1.0更宽松
```

### 调整S1敏感度

```python
# S1条件：阴线实体占比
body_size / candle_size > 0.6  # 改为0.7更严格，0.5更宽松

# S1条件：成交量放大倍数
vol_current > vol_ma5 * 1.5  # 改为2.0更严格，1.2更宽松

# S1条件：跌幅阈值
(open_current - close_current) / open_current > 0.03  # 改为0.05更严格
```

---

## 📚 延伸阅读

- [K线图优化说明.md](K线图优化说明.md) - 技术指标详解
- [出坑战法说明.md](出坑战法说明.md) - 战法原理
- [Web界面使用说明.md](Web界面使用说明.md) - 系统使用教程

---

## 🎯 快速上手清单

### 每日选股流程

```
1. ✅ 运行【出坑战法】
2. ✅ 查看选股结果
3. ✅ 点击股票查看K线图
4. ✅ 寻找B1标记（绿色▲）
5. ✅ 检查趋势线（是否多头排列）
6. ✅ 确认MACD（是否金叉）
7. ✅ 确认KDJ（J值是否回升）
8. ✅ 记录候选股票
9. ✅ 第二天入场，设置止损
10. ✅ 持续监控，看B2加仓或S1止盈
```

---

**更新时间**: 2025-11-21 22:45  
**版本**: v3.0 交易信号系统  
**祝你交易顺利，严守纪律！** 📈✨

---

## 💬 常见问题

**Q: B1信号准确率有多高？**  
A: 在强趋势环境下准确率60-70%，配合趋势线可提升至75-80%。但必须严格止损！

**Q: 可以只看B1不看趋势线吗？**  
A: 不建议。弱势环境中的B1成功率很低，必须配合趋势线判断。

**Q: 出现S1一定要卖吗？**  
A: 不一定全卖，但至少要减仓50%。如果你已经盈利较多，建议全部止盈。

**Q: B2出现后还能买吗？**  
A: 如果你持有B1仓位，可以加仓。如果没有持仓，不建议追高。

**Q: 止损位为什么是"只输一根K线"？**  
A: 这是风控核心。如果B1后直接跌破当日最低价，说明信号失效，必须立即离场，否则会越陷越深。

