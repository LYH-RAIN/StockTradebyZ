# 📈 出坑战法 B/S 信号说明

## 🎯 信号概述

出坑战法专注于捕捉**前高突破**机会，与少妇战法的KDJ超卖反弹逻辑不同。

---

## 🟢 B信号（买入）- 接近前高突破

### 信号定义
当股价回调后再次接近前高，并出现放量突破迹象时，标记B买入信号。

### 识别条件
```python
✅ 条件1：接近前高
   - 距离前60日最高价 ≤ 15%
   - 还未完全突破前高

✅ 条件2：K线形态
   - 收出阳线（收盘价 > 开盘价）
   - 价格站上10日均线

✅ 条件3：成交量确认
   - 当日成交量 > 5日均量 × 1.8
   - 放量突破，资金关注度高

✅ 条件4：趋势配合
   - 收盘价 > MA10
   - 短期均线向上
```

### 核心逻辑
```
时间线：创新高 → 回调整理 → 再次上攻接近前高 → 放量突破 → B信号

示例：
前高：¥12.50（60天前）
回调：¥10.80（震荡整理）
今日：¥11.80（距离前高5.6%）+ 放量 + 收阳 → B信号✅
```

### K线图标记
- **符号**：绿色向上三角 ▲
- **文字**："B"
- **位置**：价格下方3%
- **颜色**：与B1相同，统一绿色

---

## 🔴 S信号（卖出）- 高位大阴线

### 信号定义
在最高点或次高点附近出现放量大阴线，或连续阴线累计跌幅达到7%。

### 识别条件（两种情况）

#### 情况1：高位放量大阴线（主要）
```python
✅ 条件1：位置判断
   - 在最近30日最高价附近（≥98%最高价）
   - 或在次高价附近（≥98%次高价）

✅ 条件2：K线形态
   - 收出大阴线（阴线实体占比 > 60%）
   - 长实体，非十字星

✅ 条件3：成交量确认
   - 当日成交量 > 5日均量 × 1.5
   - 放量下跌，获利盘涌出
```

#### 情况2：连续阶梯阴量累计-7
```python
✅ 条件1：连续阴线
   - 至少连续3根阴线
   - 一旦出现阳线则中断计数

✅ 条件2：累计跌幅
   - 累计跌幅 ≥ 7%
   - 计算方式：每日(开盘-收盘)/开盘 累加

✅ 条件3：阶梯下跌
   - 连续性：不能有阳线中断
   - 形成明显的下跌趋势

示例：
Day 1: 阴线 -2.1%
Day 2: 阴线 -1.8%
Day 3: 阴线 -2.5%
Day 4: 阴线 -1.2%
累计: -7.6% ≥ -7% → S信号✅
```

### K线图标记
- **符号**：红色向下三角 ▼
- **文字**："S"
- **位置**：价格上方3%
- **颜色**：与S1相同，统一红色

---

## 📊 与少妇战法对比

### 信号对比表
```
┌─────────┬────────────────────┬────────────────────┐
│  信号   │   少妇战法         │   出坑战法         │
├─────────┼────────────────────┼────────────────────┤
│ 买入    │ B1: KDJ超卖后转强  │ B: 接近前高突破    │
│         │ B2: B1后次日继续涨 │ （无B2）           │
├─────────┼────────────────────┼────────────────────┤
│ 卖出    │ S1: 放量大阴线     │ S: 高位大阴线      │
│         │                    │    或阶梯阴量-7%   │
└─────────┴────────────────────┴────────────────────┘
```

### 适用场景对比
```
少妇战法（B1/S1）：
  ✅ 适合：超跌反弹、短期波段
  ✅ 优势：捕捉底部反转
  ⚠️ 风险：假突破较多

出坑战法（B/S）：
  ✅ 适合：突破前高、趋势延续
  ✅ 优势：成功率相对较高
  ⚠️ 风险：追高风险
```

---

## 💡 实战应用

### 案例1：标准B信号

**图表特征**：
```
价格走势：
  Day 1-20: 拉升至¥12.50（创新高）
  Day 21-50: 回调至¥10.50-11.00震荡
  Day 51: ¥11.80收盘，放量
  
技术指标：
  距离前高: (12.50-11.80)/12.50 = 5.6% ✅（<15%）
  K线: 阳线，实体较大 ✅
  成交量: 1.5M，5日均量0.7M，量比2.1 ✅（>1.8）
  MA10: ¥11.50，收盘在MA10上方 ✅

→ 满足所有条件，标记B信号 ✅
```

**操作建议**：
```
买入: Day 51收盘前或Day 52开盘
止损: ¥11.30（MA10下方）
目标: ¥12.50前高，若突破看¥13.00
```

---

### 案例2：高位S信号（情况1）

**图表特征**：
```
价格走势：
  Day 1-40: 上涨至¥13.50（最高点）
  Day 41-45: 在¥13.20-13.50震荡
  Day 46: 开盘¥13.40，收盘¥12.80
  
技术指标：
  位置: ¥13.40在最高价¥13.50的99.3%附近 ✅
  K线: 大阴线，实体占比85% ✅
  成交量: 2.8M，5日均量1.5M，量比1.87 ✅（>1.5）

→ 满足高位放量大阴线条件，标记S信号 ✅
```

**操作建议**：
```
卖出: Day 46收盘前止盈
或: 至少减仓50%
理由: 高位放量大阴，获利盘涌出
```

---

### 案例3：阶梯阴量S信号（情况2）

**图表特征**：
```
价格走势：
  Day 1: ¥12.00 → ¥11.75（-2.1%）阴线
  Day 2: ¥11.70 → ¥11.50（-1.7%）阴线
  Day 3: ¥11.45 → ¥11.20（-2.2%）阴线
  Day 4: ¥11.15 → ¥10.95（-1.8%）阴线
  
累计跌幅: -2.1% -1.7% -2.2% -1.8% = -7.8% ✅（≥-7%）
连续阴线: 4根 ✅（≥3根）

→ 满足连续阶梯阴量条件，标记S信号 ✅
```

**操作建议**：
```
卖出: Day 4发出S信号后
理由: 连续阴跌，趋势转弱
警惕: 可能进一步下跌
```

---

## 🎨 前端使用

### 切换战法类型
```
1. 点击股票查看K线图
2. 在图表上方看到战法选择器
3. 选择"少妇战法（B1/S1）"或"出坑战法（B/S）"
4. 自动重新加载对应信号
```

### 信号对比
```
建议操作：
1. 先用"少妇战法"查看B1/S1信号
2. 再切换"出坑战法"查看B/S信号
3. 对比两种战法的信号分布
4. 选择更符合当前走势的战法
```

---

## 📐 参数调整（高级）

### B信号参数
```python
# 在 _identify_breakout_signals 中调整

# 接近前高的距离阈值
distance_to_high <= 0.15  # 改为0.10更严格，0.20更宽松

# 放量倍数
current_vol > vol_ma5 * 1.8  # 改为2.0更严格，1.5更宽松

# 回看窗口
lookback_window = df.iloc[i-60:i-5]  # 改为90天更长期
```

### S信号参数
```python
# 高位判断阈值
current_high >= highest_price * 0.98  # 改为0.99更严格

# 阴线实体占比
body_size / candle_size > 0.6  # 改为0.7更严格

# 放量倍数
current_vol > vol_ma5 * 1.5  # 改为2.0更严格

# 阶梯阴量累计跌幅
cumulative_drop >= 7.0  # 改为8.0更严格，6.0更宽松
```

---

## ⚠️ 注意事项

### B信号风险
```
⚠️ 假突破风险
   - 接近前高不等于能突破
   - 建议等待真正突破后再加仓

⚠️ 追高风险
   - B信号可能在相对高位
   - 控制仓位，不要重仓

✅ 应对策略
   - 严格止损（跌破MA10）
   - 分批买入
   - 突破前高后才加仓
```

### S信号风险
```
⚠️ 误判风险
   - 可能是洗盘而非出货
   - 强势股可能快速收回

⚠️ 卖早风险
   - 阶梯阴量后可能反弹
   - 建议先减仓50%

✅ 应对策略
   - 至少减仓50%保护利润
   - 观察后续形态
   - 设好止损位
```

---

## 🔍 信号质量判断

### 优质B信号特征
```
✅ 距离前高5-10%（不太远不太近）
✅ 放量明显（量比>2.0）
✅ 实体阳线（非上影线）
✅ 站稳MA10和MA20
✅ MACD金叉或即将金叉
```

### 优质S信号特征
```
✅ 在创新高后立即出现
✅ 放量巨大（量比>2.0）
✅ 长阴实体（实体>80%）
✅ 或连续阴线累计>8%
✅ 跌破关键均线
```

---

## 📊 回测说明

### B→S配对回测
```
逻辑：
  B信号买入 → 持仓 → S信号卖出 → 计算收益

示例：
  B: 2025-06-15 买入¥11.80
  S: 2025-07-08 卖出¥13.20
  收益: (13.20-11.80)/11.80 = 11.86%
  持有: 23天
```

### 与B1→S1对比
```
出坑战法（B→S）：
  优势: 顺势突破，成功率较高
  劣势: 买入价格相对较高

少妇战法（B1→S1）：
  优势: 低位买入，风险收益比好
  劣势: 假突破较多，需严格止损
```

---

## 📚 延伸阅读

- [回测功能说明.md](回测功能说明.md)
- [B1交易体系快速指南.md](B1交易体系快速指南.md)
- [知行体系趋势线说明.md](知行体系趋势线说明.md)

---

**更新时间**：2025-11-22 00:30  
**版本**：v1.0 出坑战法信号  
**祝你交易顺利！** 📈✨

