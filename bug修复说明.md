# ğŸ”§ Bugä¿®å¤è¯´æ˜

## é—®é¢˜æ¸…å•

### 1. âœ… NaTType does not support strftime
**åŸå› **ï¼šæ—¥æœŸå­—æ®µä¸ºNaTæ—¶è°ƒç”¨strftime()  
**ä¿®å¤**ï¼šæ·»åŠ `pd.notna()`æ£€æŸ¥

```python
# ä¿®å¤å‰
last_date = df.iloc[-1]['date'].strftime('%Y-%m-%d')

# ä¿®å¤å  
if pd.notna(last_row['date']):
    last_date = last_row['date'].strftime('%Y-%m-%d')
else:
    last_date = 'N/A'
```

---

### 2. âœ… éäº¤æ˜“æ—¥æ•°æ®æœªè¿‡æ»¤
**åŸå› **ï¼šå‰ç«¯æ˜¾ç¤ºäº†volume=0çš„éäº¤æ˜“æ—¥æ•°æ®  
**ä¿®å¤**ï¼šåç«¯APIè¿‡æ»¤æ‰volume=0çš„æ•°æ®

```python
# è¿‡æ»¤æ‰éäº¤æ˜“æ—¥æ•°æ®ï¼ˆvolumeä¸º0çš„ï¼‰
df_filtered = df[df['volume'] > 0].copy()

# ä½¿ç”¨df_filteredè¿”å›ç»™å‰ç«¯
data = {
    'dates': df_filtered['date'].dt.strftime('%Y-%m-%d').tolist(),
    'open': df_filtered['open'].tolist(),
    ...
}
```

---

### 3. âš ï¸ å‡ºå‘æˆ˜æ³•Bä¿¡å·è¯†åˆ«é—®é¢˜
**ç°è±¡**ï¼šåªæœ‰Sä¿¡å·ï¼Œæ²¡æœ‰Bä¿¡å·  
**åŸå› **ï¼šBä¿¡å·æ¡ä»¶å¤ªä¸¥æ ¼ + ä¿¡å·æå–ä½ç½®é”™è¯¯

#### ä¿®å¤1ï¼šæ”¾å®½Bä¿¡å·æ¡ä»¶
```python
# ä¿®å¤å‰
distance_to_high <= 0.15  # è·ç¦»å‰é«˜15%
current_vol > vol_ma5 * 1.8  # é‡æ¯”1.8

# ä¿®å¤å
distance_to_high <= 0.20  # è·ç¦»å‰é«˜20%
current_vol > vol_ma5 * 1.5  # é‡æ¯”1.5
current_close >= current_open * 0.98  # å…è®¸å°é˜´çº¿
current_close >= ma10_value * 0.98  # å…è®¸æ¥è¿‘MA10
```

#### ä¿®å¤2ï¼šä¿¡å·æå–åœ¨è¿‡æ»¤åæ•°æ®ä¸Š
```python
# ä¿®å¤å‰ï¼šåœ¨å®Œæ•´æ•°æ®ä¸Šæå–ä¿¡å·ï¼Œç„¶åè¿‡æ»¤æ•°æ®
# é—®é¢˜ï¼šä¿¡å·å¯èƒ½åœ¨éäº¤æ˜“æ—¥è¢«è¿‡æ»¤æ‰

# ä¿®å¤åï¼šå…ˆè¿‡æ»¤æ•°æ®ï¼Œå†åœ¨è¿‡æ»¤åæ•°æ®ä¸Šæå–ä¿¡å·
df_filtered = df[df['volume'] > 0].copy()

signals = []
for idx, row in df_filtered.iterrows():  # åœ¨è¿‡æ»¤åæ•°æ®ä¸Šæå–
    if row['signal'] in ['B1', 'B2', 'S1', 'B', 'S']:
        ...
```

---

### 4. âœ… JavaScripté”™è¯¯
**ç°è±¡**ï¼š`resultDiv is not defined`  
**åŸå› **ï¼šæµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬ä»£ç   
**ä¿®å¤**ï¼šæ— éœ€ä¿®æ”¹ä»£ç ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å³å¯

```bash
# æ¸…é™¤ç¼“å­˜æ–¹æ³•
1. æŒ‰ Cmd+Shift+Deleteï¼ˆMacï¼‰æˆ– Ctrl+Shift+Deleteï¼ˆWindowsï¼‰
2. é€‰æ‹©"ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶"
3. ç‚¹å‡»"æ¸…é™¤æ•°æ®"
4. ç¡¬åˆ·æ–°é¡µé¢ï¼šCmd+Shift+Rï¼ˆMacï¼‰æˆ– Ctrl+Shift+Rï¼ˆWindowsï¼‰
```

---

### 5. âš ï¸ Permissions policy violation
**ç°è±¡**ï¼šæ§åˆ¶å°è­¦å‘Š`unload is not allowed`  
**åŸå› **ï¼šæµè§ˆå™¨å®‰å…¨ç­–ç•¥é™åˆ¶  
**å½±å“**ï¼šæ— å®é™…å½±å“ï¼Œå¯å¿½ç•¥  
**è¯´æ˜**ï¼šè¿™æ˜¯Plotlyåº“ä½¿ç”¨unloadäº‹ä»¶å¯¼è‡´çš„è­¦å‘Šï¼Œä¸å½±å“åŠŸèƒ½

---

## ä¿®å¤æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `web_app.py` | æ·»åŠ NaTæ£€æŸ¥ã€è¿‡æ»¤éäº¤æ˜“æ—¥ã€æ”¾å®½Bä¿¡å·æ¡ä»¶ |
| `static/js/app.js` | æ— éœ€ä¿®æ”¹ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰ |

---

## æµ‹è¯•æ–¹æ³•

### 1. é‡å¯æœåŠ¡
```bash
lsof -ti:5000 | xargs kill -9
cd /Users/liuyuhang/cursor/StockTradebyZ
python3 web_app.py
```

### 2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
```
Cmd+Shift+Delete â†’ æ¸…é™¤ç¼“å­˜ â†’ Cmd+Shift+R ç¡¬åˆ·æ–°
```

### 3. æµ‹è¯•å‡ºå‘æˆ˜æ³•
```
1. è®¿é—® http://127.0.0.1:5000
2. ç‚¹å‡»ã€å‡ºå‘æˆ˜æ³•ã€‘
3. ç‚¹å‡»ä»»æ„è‚¡ç¥¨
4. åˆ‡æ¢åˆ°"å‡ºå‘æˆ˜æ³•ï¼ˆB/Sï¼‰"
5. æŸ¥çœ‹Bä¿¡å·å’ŒSä¿¡å·
```

### 4. éªŒè¯éäº¤æ˜“æ—¥è¿‡æ»¤
```
1. æŸ¥çœ‹Kçº¿å›¾æ¨ªåæ ‡
2. ç¡®è®¤æ²¡æœ‰å‘¨æœ«å’ŒèŠ‚å‡æ—¥
3. æ•°æ®è¿ç»­æ€§æ­£å¸¸
```

---

## è°ƒè¯•ä¿¡æ¯

### æŸ¥çœ‹æ—¥å¿—
```bash
tail -f web_fixed.log
```

### æµ‹è¯•API
```bash
curl "http://127.0.0.1:5000/api/stock/603027?days=120&strategy=breakout" | python3 -m json.tool
```

### æ£€æŸ¥ä¿¡å·æ•°é‡
```python
# åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾
DEBUG: å®Œæ•´æ•°æ®Bä¿¡å·: XXä¸ª, æˆªå–åBä¿¡å·: YYä¸ª
```

---

## å·²çŸ¥é—®é¢˜

### é—®é¢˜ï¼šéƒ¨åˆ†è‚¡ç¥¨æ— Bä¿¡å·
**åŸå› **ï¼š
1. è‚¡ä»·æœªæ¥è¿‘å‰é«˜ï¼ˆè·ç¦»>20%ï¼‰
2. æˆäº¤é‡ä¸è¶³ï¼ˆé‡æ¯”<1.5ï¼‰
3. æœªç«™ä¸ŠMA10çº¿

**è§£å†³**ï¼š
- è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œä¸æ˜¯æ‰€æœ‰è‚¡ç¥¨éƒ½ç¬¦åˆå‡ºå‘æˆ˜æ³•æ¡ä»¶
- å¯ä»¥åˆ‡æ¢åˆ°"å°‘å¦‡æˆ˜æ³•"æŸ¥çœ‹B1/S1ä¿¡å·
- æˆ–è°ƒæ•´å‚æ•°ä½¿æ¡ä»¶æ›´å®½æ¾

---

## ä¸‹ä¸€æ­¥ä¼˜åŒ–

### å¯é€‰ä¼˜åŒ–é¡¹
```
â–¡ ä¸ºBä¿¡å·æ·»åŠ æ›´å¤šè°ƒè¯•ä¿¡æ¯
â–¡ åœ¨å‰ç«¯æ˜¾ç¤ºä¿¡å·è¯†åˆ«è¯¦æƒ…
â–¡ æ”¯æŒå‚æ•°è‡ªå®šä¹‰è°ƒæ•´
â–¡ æ·»åŠ ä¿¡å·è´¨é‡è¯„åˆ†
â–¡ ä¼˜åŒ–Sä¿¡å·è¯†åˆ«é€»è¾‘
```

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-22 01:00  
**ç‰ˆæœ¬**ï¼šv6.1 Bugä¿®å¤ç‰ˆ

